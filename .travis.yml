language: node_js
node_js:
  - "node"
  - "8"
services:
  - mongodb
cache:
  directories:
    - "node_modules"
env:
  global:
    - JWT_TOKEN=randomtoken7582048
    - MONGODB_URI=mongodb://localhost:27017/db_book_test
    - PORT=3356
  matrix:
    - NODE_ENV=development
    - NODE_ENV=production
install:
  - npm --production=false install
before_script:
  - mkdir -p logs && touch logs/{mongodb-connection.log,error.log}
  - if [ "${NODE_ENV}" = "production" ]; then npm run start-prod & sleep 5s && pkill node; fi
script:
  - if [ "${NODE_ENV}" = "development" ]; then npm test; fi
branches:
  only:
    - master